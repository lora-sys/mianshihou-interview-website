# 前端开发计划

## 项目概述

面试后系统前端开发计划，基于 Next.js 16 + React 19 + tRPC 构建类型安全的前后端应用。

### 技术栈

- **框架**: Next.js 16.1.0 (App Router)
- **UI 库**: React 19.2.0
- **状态管理**: TanStack Query 5.x
- **表单处理**: TanStack Form
- **组件库**: shadcn/ui
- **类型安全**: tRPC + TypeScript
- **样式**: Tailwind CSS (通过 shadcn/ui)
- **图标**: Lucide React

### 项目结构

```
mianshihou/
├── apps/
│   ├── api/                    # 后端 API (Fastify + tRPC)
│   │   └── trpc/
│   │       ├── index.ts        # tRPC 客户端类型导出
│   │       └── router/
│   │           └── index.ts    # AppRouter 类型导出
│   └── web/                    # 前端应用 (Next.js)
│       ├── app/
│       │   ├── (auth)/         # 认证相关页面组
│       │   │   ├── login/
│       │   │   │   └── page.tsx
│       │   │   └── register/
│       │   │       └── page.tsx
│       │   ├── (dashboard)/    # Dashboard 页面组
│       │   │   ├── layout.tsx  # Dashboard 布局
│       │   │   └── page.tsx    # Dashboard 首页
│       │   ├── (questions)/    # 题目管理页面组
│       │   │   ├── questions/
│       │   │   │   ├── page.tsx        # 题目列表
│       │   │   │   └── [id]/
│       │   │   │       └── page.tsx    # 题目详情
│       │   │   └── question-banks/
│       │   │       ├── page.tsx        # 题库列表
│       │   │       └── [id]/
│       │   │           └── page.tsx    # 题库详情
│       │   ├── components/      # 页面级组件
│       │   ├── lib/             # 工具函数和配置
│       │   │   ├── trpc/       # tRPC 客户端配置
│       │   │   └── utils.ts    # 工具函数
│       │   ├── layout.tsx       # 根布局
│       │   └── globals.css      # 全局样式
│       └── package.json
└── packages/
    └── ui/                      # 共享 UI 组件库
        └── src/
            └── components/      # shadcn/ui 组件
```

---

## 开发阶段

### 阶段 1: 项目配置与依赖安装

#### 1.1 安装核心依赖

```bash
cd apps/web
bun add @tanstack/react-query @tanstack/react-form
bun add -d @types/node
```

#### 1.2 配置 Tailwind CSS

shadcn/ui 需要 Tailwind CSS 作为样式基础：

```bash
bun add -d tailwindcss postcss autoprefixer
bun add class-variance-authority clsx tailwind-merge
```

创建 `tailwind.config.ts`:
```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./app/**/*.{ts,tsx}",
    "./components/**/*.{ts,tsx}",
    "./lib/**/*.{ts,tsx}",
    "../../../packages/ui/src/**/*.{ts,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        // ... 更多 shadcn/ui 主题变量
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};

export default config;
```

#### 1.3 安装 shadcn/ui

```bash
bun add -d shadcn-ui
bun add tailwind-animate
```

初始化 shadcn/ui CLI:
```bash
bunx shadcn-ui@latest init
```

选择以下选项：
- Style: Default
- Base color: Slate
- CSS variables: Yes

#### 1.4 安装常用 shadcn/ui 组件

```bash
# 核心组件
bunx shadcn-ui@latest add button card input label form dialog toast table badge alert
```

#### 1.5 配置 tRPC 客户端

创建 `apps/web/lib/trpc/client.ts`:
```typescript
import { createTRPCReact } from '@trpc/react-query';
import type { AppRouter } from '../../../apps/api/trpc/router/index';

export const trpc = createTRPCReact<AppRouter>();
```

创建 `apps/web/lib/trpc/provider.tsx`:
```typescript
"use client";

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { httpBatchLink } from '@trpc/client';
import { useState } from 'react';
import { trpc } from './client';

export function TRPCProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient());
  const [trpcClient] = useState(() =>
    trpc.createClient({
      links: [
        httpBatchLink({
          url: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/trpc',
        }),
      ],
    })
  );

  return (
    <trpc.Provider client={trpcClient} queryClient={queryClient}>
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    </trpc.Provider>
  );
}
```

更新 `apps/web/app/layout.tsx`:
```typescript
import { TRPCProvider } from './lib/trpc/provider';
import "./globals.css";

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="zh-CN">
      <body>
        <TRPCProvider>{children}</TRPCProvider>
      </body>
    </html>
  );
}
```

---

### 阶段 2: 认证页面 (登录/注册)

#### 2.1 登录页面

创建 `apps/web/app/(auth)/login/page.tsx`:
```typescript
"use client";

import { useState } from 'react';
import { useForm } from '@tanstack/react-form';
import { trpc } from '@/lib/trpc/client';
import { Button } from '@repo/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

export default function LoginPage() {
  const loginMutation = trpc.auth.login.useMutation();

  const form = useForm({
    defaultValues: {
      email: '',
      password: '',
    },
    onSubmit: async ({ value }) => {
      await loginMutation.mutateAsync(value);
      // 登录成功后跳转到 Dashboard
      window.location.href = '/dashboard';
    },
  });

  return (
    <div className="min-h-screen flex items-center justify-center">
      <form.Provider>
        <form
          onSubmit={(e) => {
            e.preventDefault();
            form.handleSubmit();
          }}
          className="space-y-4 w-full max-w-md"
        >
          <h1 className="text-2xl font-bold">登录</h1>

          <form.Field
            name="email"
            children={(field) => (
              <div>
                <Label htmlFor={field.name}>邮箱</Label>
                <Input
                  id={field.name}
                  value={field.state.value}
                  onChange={(e) => field.handleChange(e.target.value)}
                  placeholder="请输入邮箱"
                />
              </div>
            )}
          />

          <form.Field
            name="password"
            children={(field) => (
              <div>
                <Label htmlFor={field.name}>密码</Label>
                <Input
                  id={field.name}
                  type="password"
                  value={field.state.value}
                  onChange={(e) => field.handleChange(e.target.value)}
                  placeholder="请输入密码"
                />
              </div>
            )}
          />

          <Button type="submit" disabled={loginMutation.isPending}>
            {loginMutation.isPending ? '登录中...' : '登录'}
          </Button>
        </form>
      </form.Provider>
    </div>
  );
}
```

#### 2.2 注册页面

创建 `apps/web/app/(auth)/register/page.tsx`:
```typescript
"use client";

import { useForm } from '@tanstack/react-form';
import { trpc } from '@/lib/trpc/client';
import { Button } from '@repo/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

export default function RegisterPage() {
  const registerMutation = trpc.auth.register.useMutation();

  const form = useForm({
    defaultValues: {
      email: '',
      password: '',
      userName: '',
    },
    onSubmit: async ({ value }) => {
      await registerMutation.mutateAsync(value);
      // 注册成功后跳转到登录页
      window.location.href = '/login';
    },
  });

  return (
    <div className="min-h-screen flex items-center justify-center">
      <form.Provider>
        <form
          onSubmit={(e) => {
            e.preventDefault();
            form.handleSubmit();
          }}
          className="space-y-4 w-full max-w-md"
        >
          <h1 className="text-2xl font-bold">注册</h1>

          <form.Field
            name="userName"
            children={(field) => (
              <div>
                <Label htmlFor={field.name}>用户名</Label>
                <Input
                  id={field.name}
                  value={field.state.value}
                  onChange={(e) => field.handleChange(e.target.value)}
                  placeholder="请输入用户名"
                />
              </div>
            )}
          />

          <form.Field
            name="email"
            children={(field) => (
              <div>
                <Label htmlFor={field.name}>邮箱</Label>
                <Input
                  id={field.name}
                  type="email"
                  value={field.state.value}
                  onChange={(e) => field.handleChange(e.target.value)}
                  placeholder="请输入邮箱"
                />
              </div>
            )}
          />

          <form.Field
            name="password"
            children={(field) => (
              <div>
                <Label htmlFor={field.name}>密码</Label>
                <Input
                  id={field.name}
                  type="password"
                  value={field.state.value}
                  onChange={(e) => field.handleChange(e.target.value)}
                  placeholder="请输入密码"
                />
              </div>
            )}
          />

          <Button type="submit" disabled={registerMutation.isPending}>
            {registerMutation.isPending ? '注册中...' : '注册'}
          </Button>
        </form>
      </form.Provider>
    </div>
  );
}
```

---

### 阶段 3: Dashboard 首页

#### 3.1 Dashboard 布局

创建 `apps/web/app/(dashboard)/layout.tsx`:
```typescript
import Link from 'next/link';
import { User, BookOpen, FileText, LogOut } from 'lucide-react';

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="flex min-h-screen">
      {/* 侧边栏 */}
      <aside className="w-64 border-r bg-background p-4">
        <h1 className="text-xl font-bold mb-6">面试后</h1>
        <nav className="space-y-2">
          <Link
            href="/dashboard"
            className="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent"
          >
            <User className="w-4 h-4" />
            用户管理
          </Link>
          <Link
            href="/questions"
            className="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent"
          >
            <FileText className="w-4 h-4" />
            题目管理
          </Link>
          <Link
            href="/question-banks"
            className="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent"
          >
            <BookOpen className="w-4 h-4" />
            题库管理
          </Link>
        </nav>
      </aside>

      {/* 主内容区 */}
      <main className="flex-1 p-6">{children}</main>
    </div>
  );
}
```

#### 3.2 Dashboard 首页

创建 `apps/web/app/(dashboard)/page.tsx`:
```typescript
"use client";

import { trpc } from '@/lib/trpc/client';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Users, BookOpen, FileText } from 'lucide-react';

export default function DashboardPage() {
  const { data: stats, isLoading } = trpc.users.listWithStats.useQuery();

  if (isLoading) return <div>加载中...</div>;

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold">Dashboard</h1>

      <div className="grid gap-4 md:grid-cols-3">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">总用户数</CardTitle>
            <Users className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.totalUsers || 0}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">活跃用户</CardTitle>
            <Users className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.activeUsers || 0}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">新增用户</CardTitle>
            <Users className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.newUsers || 0}</div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

---

### 阶段 4: 题目管理页面

#### 4.1 题目列表页

创建 `apps/web/app/(questions)/questions/page.tsx`:
```typescript
"use client";

import { trpc } from '@/lib/trpc/client';
import { Button } from '@repo/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Pencil, Trash2, Plus } from 'lucide-react';

export default function QuestionsPage() {
  const { data: questions, isLoading } = trpc.questions.list.useQuery();
  const deleteMutation = trpc.questions.delete.useMutation();

  if (isLoading) return <div>加载中...</div>;

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">题目列表</h1>
        <Button>
          <Plus className="w-4 h-4 mr-2" />
          新增题目
        </Button>
      </div>

      <div className="grid gap-4">
        {questions?.data.map((question) => (
          <Card key={question.id}>
            <CardHeader>
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <CardTitle>{question.questionTitle}</CardTitle>
                  <div className="flex gap-2 mt-2">
                    <Badge>{question.questionType}</Badge>
                    <Badge variant="secondary">{question.difficulty}</Badge>
                  </div>
                </div>
                <div className="flex gap-2">
                  <Button variant="ghost" size="icon">
                    <Pencil className="w-4 h-4" />
                  </Button>
                  <Button
                    variant="ghost"
                    size="icon"
                    onClick={() => deleteMutation.mutate({ id: question.id })}
                  >
                    <Trash2 className="w-4 h-4" />
                  </Button>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              <p className="text-muted-foreground">{question.questionContent}</p>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
```

#### 4.2 题目详情页

创建 `apps/web/app/(questions)/questions/[id]/page.tsx`:
```typescript
"use client";

import { useParams } from 'next/navigation';
import { trpc } from '@/lib/trpc/client';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@repo/ui/button';

export default function QuestionDetailPage() {
  const params = useParams();
  const { data: question, isLoading } = trpc.questions.getById.useQuery({
    id: params.id as string,
  });

  if (isLoading) return <div>加载中...</div>;

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">题目详情</h1>
        <Button>编辑</Button>
      </div>

      <Card>
        <CardHeader>
          <div className="flex items-start justify-between">
            <div>
              <CardTitle className="text-2xl">{question?.questionTitle}</CardTitle>
              <div className="flex gap-2 mt-3">
                <Badge>{question?.questionType}</Badge>
                <Badge variant="secondary">{question?.difficulty}</Badge>
              </div>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <h3 className="font-semibold mb-2">题目内容</h3>
            <p className="text-muted-foreground">{question?.questionContent}</p>
          </div>

          {question?.options && (
            <div>
              <h3 className="font-semibold mb-2">选项</h3>
              <ul className="space-y-2">
                {JSON.parse(question.options).map((option: string, index: number) => (
                  <li key={index} className="text-muted-foreground">
                    {String.fromCharCode(65 + index)}. {option}
                  </li>
                ))}
              </ul>
            </div>
          )}

          {question?.answer && (
            <div>
              <h3 className="font-semibold mb-2">答案</h3>
              <p className="text-muted-foreground">{question.answer}</p>
            </div>
          )}

          {question?.analysis && (
            <div>
              <h3 className="font-semibold mb-2">解析</h3>
              <p className="text-muted-foreground">{question.analysis}</p>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
```

---

### 阶段 5: 题库管理页面

#### 5.1 题库列表页

创建 `apps/web/app/(questions)/question-banks/page.tsx`:
```typescript
"use client";

import { trpc } from '@/lib/trpc/client';
import { Button } from '@repo/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Pencil, Trash2, Plus, BookOpen } from 'lucide-react';

export default function QuestionBanksPage() {
  const { data: questionBanks, isLoading } = trpc.questionBanks.listWithQuestionCount.useQuery();
  const deleteMutation = trpc.questionBanks.delete.useMutation();

  if (isLoading) return <div>加载中...</div>;

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">题库列表</h1>
        <Button>
          <Plus className="w-4 h-4 mr-2" />
          新增题库
        </Button>
      </div>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {questionBanks?.data.map((bank) => (
          <Card key={bank.id}>
            <CardHeader>
              <div className="flex items-start justify-between">
                <CardTitle className="text-lg">{bank.questionBankName}</CardTitle>
                <div className="flex gap-1">
                  <Button variant="ghost" size="icon">
                    <Pencil className="w-4 h-4" />
                  </Button>
                  <Button
                    variant="ghost"
                    size="icon"
                    onClick={() => deleteMutation.mutate({ id: bank.id })}
                  >
                    <Trash2 className="w-4 h-4" />
                  </Button>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-muted-foreground mb-4">
                {bank.description}
              </p>
              <div className="flex items-center gap-2 text-sm">
                <BookOpen className="w-4 h-4" />
                <span>{bank.questionCount || 0} 道题目</span>
              </div>
              <Badge className="mt-3">{bank.category}</Badge>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
```

#### 5.2 题库详情页

创建 `apps/web/app/(questions)/question-banks/[id]/page.tsx`:
```typescript
"use client";

import { useParams } from 'next/navigation';
import { trpc } from '@/lib/trpc/client';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@repo/ui/button';
import { BookOpen, Calendar } from 'lucide-react';

export default function QuestionBankDetailPage() {
  const params = useParams();
  const { data: bank, isLoading } = trpc.questionBanks.getById.useQuery({
    id: params.id as string,
  });

  if (isLoading) return <div>加载中...</div>;

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">题库详情</h1>
        <Button>编辑</Button>
      </div>

      <Card>
        <CardHeader>
          <CardTitle className="text-2xl">{bank?.questionBankName}</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <h3 className="font-semibold mb-2">描述</h3>
            <p className="text-muted-foreground">{bank?.description}</p>
          </div>

          <div className="flex gap-4">
            <div className="flex items-center gap-2">
              <Badge>{bank?.category}</Badge>
            </div>
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
              <Calendar className="w-4 h-4" />
              <span>创建于 {new Date(bank?.createdAt || '').toLocaleDateString()}</span>
            </div>
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>题库中的题目</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-center py-8 text-muted-foreground">
            <BookOpen className="w-12 h-12 mx-auto mb-4 opacity-50" />
            <p>该题库暂无题目</p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

---

## 类型共享配置

### tRPC 类型导出

后端已在 `apps/api/trpc/router/index.ts` 中导出 `AppRouter` 类型：

```typescript
export type AppRouter = typeof appRouter;
```

### 前端导入类型

前端通过 tRPC 客户端自动获取类型：

```typescript
import { trpc } from '@/lib/trpc/client';

// 类型完全自动推断，无需手动导入
const { data } = trpc.users.list.useQuery();
// data 的类型自动从后端推断
```

### TypeScript 路径配置

确保 `tsconfig.json` 中配置了正确的路径别名：

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./app/*"],
      "@/components/*": ["./app/components/*"],
      "@/lib/*": ["./app/lib/*"]
    }
  }
}
```

---

## Dashboard 参考实现

参考项目: https://github.com/silicondeck/shadcn-dashboard-landing-template

### 关键特性借鉴

1. **响应式侧边栏**: 支持移动端折叠
2. **卡片布局**: 使用 Grid 布局展示统计数据
3. **主题切换**: 支持深色/浅色模式
4. **数据可视化**: 集成图表库展示趋势
5. **表格组件**: 高级表格功能（排序、筛选、分页）

### 建议集成的组件

- `shadcn/ui` 的 Data Table 组件
- Lucide React 图标库
- Recharts 或 Chart.js 用于数据可视化

---

## 开发优先级

1. **阶段 1**: 项目配置与依赖安装 ⏳
2. **阶段 2**: 认证页面（登录/注册）
3. **阶段 3**: Dashboard 首页
4. **阶段 4**: 题目管理页面（列表 + 详情）
5. **阶段 5**: 题库管理页面（列表 + 详情）

---

## 注意事项

1. **类型安全**: 所有 API 调用都通过 tRPC，类型完全自动推断
2. **错误处理**: 使用 TanStack Query 的 `onError` 处理错误
3. **加载状态**: 使用 `isLoading` 和 `isPending` 显示加载状态
4. **表单验证**: 使用 TanStack Form 的 `validators` 进行表单验证
5. **响应式设计**: 使用 Tailwind CSS 的响应式类名
6. **深色模式**: 使用 `dark:` 类名和 CSS 变量

---

## 下一步行动

1. ✅ 确认本开发计划
2. ⏳ 开始阶段 1: 项目配置与依赖安装
3. ⏳ 按顺序完成各个开发阶段
4. ⏳ 测试类型共享是否正常工作
5. ⏳ 部署到生产环境