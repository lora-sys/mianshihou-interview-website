# CI/CD æŒ‡å—

## ğŸ“– ä»€ä¹ˆæ˜¯ CI/CDï¼Ÿ

### CIï¼ˆContinuous Integration - æŒç»­é›†æˆï¼‰

**å®šä¹‰**ï¼šæŒç»­é›†æˆæ˜¯ä¸€ç§å¼€å‘å®è·µï¼Œè¦æ±‚å¼€å‘è€…é¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°ä¸»åˆ†æ”¯ï¼Œæ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œæµ‹è¯•æ¥éªŒè¯ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š
- é¢‘ç¹æäº¤ä»£ç ï¼ˆæ¯å¤©å¤šæ¬¡ï¼‰
- æ¯æ¬¡æäº¤éƒ½è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- å°½æ—©å‘ç°å’Œä¿®å¤é”™è¯¯

**å¥½å¤„**ï¼š
- âœ… å¿«é€Ÿå‘ç°é”™è¯¯ï¼Œå‡å°‘ä¿®å¤æˆæœ¬
- âœ… æé«˜ä»£ç è´¨é‡
- âœ… å‡å°‘é›†æˆé—®é¢˜
- âœ… æé«˜å¼€å‘æ•ˆç‡

### CDï¼ˆContinuous Deployment - æŒç»­éƒ¨ç½²ï¼‰

**å®šä¹‰**ï¼šæŒç»­éƒ¨ç½²æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–çš„æ–¹å¼å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š
- ä»£ç é€šè¿‡æµ‹è¯•åè‡ªåŠ¨éƒ¨ç½²
- æ— éœ€æ‰‹åŠ¨å¹²é¢„
- å¿«é€Ÿå‘å¸ƒæ–°åŠŸèƒ½

**å¥½å¤„**ï¼š
- âœ… å‡å°‘äººä¸ºé”™è¯¯
- âœ… åŠ å¿«å‘å¸ƒé€Ÿåº¦
- âœ… å¿«é€Ÿå›æ»š
- âœ… æé«˜ç”¨æˆ·æ»¡æ„åº¦

## ğŸš€ GitHub Actions å·¥ä½œåŸç†

GitHub Actions æ˜¯ GitHub æä¾›çš„ CI/CD æœåŠ¡ï¼Œå®Œå…¨å…è´¹ï¼ˆå…¬å¼€ä»“åº“ï¼‰æˆ–æœ‰é™å…è´¹ï¼ˆç§æœ‰ä»“åº“ï¼‰ã€‚

### å·¥ä½œæµç¨‹

```
å¼€å‘è€…æ¨é€ä»£ç 
    â†“
GitHub æ£€æµ‹åˆ°æ¨é€
    â†“
è§¦å‘ GitHub Actions
    â†“
è¿è¡Œå·¥ä½œæµï¼ˆæµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²ï¼‰
    â†“
æ˜¾ç¤ºç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
    â†“
é€šçŸ¥å¼€å‘è€…
```

### å…³é”®æ¦‚å¿µ

1. **Workflowï¼ˆå·¥ä½œæµï¼‰**ï¼šä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨åŒ–æµç¨‹
2. **Jobï¼ˆä»»åŠ¡ï¼‰**ï¼šå·¥ä½œæµä¸­çš„ä¸€ä¸ªæ­¥éª¤
3. **Stepï¼ˆæ­¥éª¤ï¼‰**ï¼šä»»åŠ¡ä¸­çš„å…·ä½“æ“ä½œ
4. **Actionï¼ˆåŠ¨ä½œï¼‰**ï¼šå¯é‡ç”¨çš„ä»£ç ç‰‡æ®µ
5. **Runnerï¼ˆè¿è¡Œå™¨ï¼‰**ï¼šæ‰§è¡Œå·¥ä½œæµçš„æœåŠ¡å™¨

## ğŸ”§ ä¸ºä½ çš„é¡¹ç›®é…ç½® CI/CD

### æ–¹æ¡ˆ 1ï¼šç®€å•ç‰ˆï¼ˆåªè¿è¡Œæµ‹è¯•ï¼‰

æ–‡ä»¶ï¼š`.github/workflows/test.yml`

```yaml
name: Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: |
          cd mianshihou/apps/api
          bun install

      - name: Run tests
        run: |
          cd mianshihou/apps/api
          bun test
```

**è§¦å‘æ¡ä»¶**ï¼š
- æ¨é€åˆ° `main` åˆ†æ”¯
- åˆ›å»ºé’ˆå¯¹ `main` åˆ†æ”¯çš„ Pull Request

**æ‰§è¡Œæ­¥éª¤**ï¼š
1. æ£€å‡ºä»£ç 
2. è®¾ç½® Bun ç¯å¢ƒ
3. å®‰è£…ä¾èµ–
4. è¿è¡Œæµ‹è¯•

### æ–¹æ¡ˆ 2ï¼šå®Œæ•´ç‰ˆï¼ˆæµ‹è¯• + ä»£ç æ£€æŸ¥ + æ„å»ºï¼‰

æ–‡ä»¶ï¼š`.github/workflows/ci.yml`

åŒ…å«ä»¥ä¸‹ä»»åŠ¡ï¼š
- âœ… è¿è¡Œæµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰
- âœ… ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- âœ… ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆESLintï¼‰
- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… æ•°æ®åº“è¿ç§»æ£€æŸ¥
- âœ… æ„å»ºé¡¹ç›®
- âœ… å®‰å…¨æ‰«æ

## ğŸ“Š æŸ¥çœ‹æµ‹è¯•ç»“æœ

### åœ¨ GitHub ä¸ŠæŸ¥çœ‹

1. è¿›å…¥ä½ çš„ä»“åº“
2. ç‚¹å‡» "Actions" æ ‡ç­¾
3. é€‰æ‹©ä¸€ä¸ªå·¥ä½œæµ
4. æŸ¥çœ‹è¿è¡Œç»“æœ

### çŠ¶æ€å¾½ç« 

åœ¨ README.md ä¸­æ·»åŠ çŠ¶æ€å¾½ç« ï¼š

```markdown
![Tests](https://github.com/ä½ çš„ç”¨æˆ·å/mianshihou-interview-website/actions/workflows/test.yml/badge.svg)
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é¢‘ç¹æäº¤ä»£ç 
```bash
# âŒ ä¸å¥½ï¼šä¸€æ¬¡æäº¤å¤§é‡ä»£ç 
git add .
git commit -m "å®Œæˆæ‰€æœ‰åŠŸèƒ½"
git push

# âœ… å¥½ï¼šé¢‘ç¹æäº¤å°æ”¹åŠ¨
git add auth.ts
git commit -m "æ·»åŠ è®¤è¯åŠŸèƒ½"
git push

git add user.ts
git commit -m "æ·»åŠ ç”¨æˆ·ç®¡ç†"
git push
```

### 2. ç¼–å†™æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯
```bash
# âŒ ä¸å¥½
git commit -m "update"

# âœ… å¥½
git commit -m "feat(auth): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
git commit -m "fix(auth): ä¿®å¤ cookie è®¾ç½®é—®é¢˜"
git commit -m "test(auth): æ·»åŠ ç™»å½•é›†æˆæµ‹è¯•"
```

### 3. ä½¿ç”¨åˆ†æ”¯ç­–ç•¥
```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/user-management

# 2. å¼€å‘å¹¶æäº¤
git add .
git commit -m "feat: æ·»åŠ ç”¨æˆ·ç®¡ç†åŠŸèƒ½"

# 3. æ¨é€åˆ°è¿œç¨‹
git push origin feature/user-management

# 4. åˆ›å»º Pull Request
# åœ¨ GitHub ä¸Šåˆ›å»º PR

# 5. ç­‰å¾… CI/CD é€šè¿‡
# å¦‚æœå¤±è´¥ï¼Œä¿®å¤åå†æ¬¡æ¨é€

# 6. åˆå¹¶åˆ°ä¸»åˆ†æ”¯
```

### 4. è®¾ç½®ä¿æŠ¤è§„åˆ™

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­ï¼š
1. è¿›å…¥ Settings â†’ Branches
2. æ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™
3. è¦æ±‚ï¼š
   - âœ… çŠ¶æ€æ£€æŸ¥é€šè¿‡
   - âœ… ä»£ç å®¡æŸ¥
   - âœ… åˆ†æ”¯æ˜¯æœ€æ–°çš„

## ğŸ” å¸¸è§é—®é¢˜

### Q1: CI/CD å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

**æ­¥éª¤**ï¼š
1. æŸ¥çœ‹ Actions æ—¥å¿—ï¼Œæ‰¾åˆ°å¤±è´¥åŸå› 
2. åœ¨æœ¬åœ°å¤ç°é—®é¢˜
3. ä¿®å¤é—®é¢˜
4. æäº¤ä¿®å¤
5. ç­‰å¾… CI/CD å†æ¬¡è¿è¡Œ

### Q2: å¦‚ä½•è·³è¿‡ CI/CDï¼Ÿ

åœ¨æäº¤ä¿¡æ¯ä¸­æ·»åŠ  `[skip ci]`ï¼š

```bash
git commit -m "update readme [skip ci]"
```

### Q3: å¦‚ä½•åªåœ¨ç‰¹å®šæ–‡ä»¶å˜åŒ–æ—¶è¿è¡Œæµ‹è¯•ï¼Ÿ

```yaml
on:
  push:
    paths:
      - 'mianshihou/apps/api/**'
      - '.github/workflows/**'
```

### Q4: å¦‚ä½•ç¼“å­˜ä¾èµ–ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦ï¼Ÿ

```yaml
- name: Cache Bun dependencies
  uses: actions/cache@v3
  with:
    path: |
      ~/.bun/install/cache
      node_modules
    key: ${{ runner.os }}-bun-${{ hashFiles('**/bun.lockb') }}
```

## ğŸ“ˆ CI/CD æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

1. **æ„å»ºæ—¶é—´**ï¼šç†æƒ³æƒ…å†µä¸‹ < 5 åˆ†é’Ÿ
2. **æµ‹è¯•è¦†ç›–ç‡**ï¼šç›®æ ‡ > 80%
3. **å¤±è´¥ç‡**ï¼šç›®æ ‡ < 5%
4. **éƒ¨ç½²é¢‘ç‡**ï¼šæ¯å‘¨å¤šæ¬¡

### æ”¹è¿›å»ºè®®

1. **å¹¶è¡ŒåŒ–ä»»åŠ¡**ï¼šåŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡
2. **ç¼“å­˜ä¾èµ–**ï¼šå‡å°‘ä¸‹è½½æ—¶é—´
3. **ä¼˜åŒ–æµ‹è¯•**ï¼šåªè¿è¡Œç›¸å…³æµ‹è¯•
4. **å¢é‡æ„å»º**ï¼šåªæ„å»ºå˜åŒ–çš„éƒ¨åˆ†

## ğŸ“ è¿›é˜¶ä¸»é¢˜

### 1. è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

```yaml
deploy:
  needs: [test, build]
  runs-on: ubuntu-latest
  if: github.ref == 'refs/heads/main'
  
  steps:
    - name: Deploy to production
      run: |
        # éƒ¨ç½²å‘½ä»¤
        ./deploy.sh
```

### 2. å¤šç¯å¢ƒéƒ¨ç½²

```yaml
deploy-staging:
  if: github.ref == 'refs/heads/develop'
  # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

deploy-production:
  if: github.ref == 'refs/heads/main'
  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### 3. é€šçŸ¥é›†æˆ

```yaml
- name: Notify on failure
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [CI/CD æœ€ä½³å®è·µ](https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment)
- [æµ‹è¯•è¦†ç›–ç‡æŒ‡å—](https://jestjs.io/docs/configuration#collectcoverage-boolean)

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… åˆ›å»º `.github/workflows/test.yml`
2. âœ… æ¨é€åˆ° GitHub
3. âœ… æŸ¥çœ‹ Actions è¿è¡Œç»“æœ
4. â³ æ·»åŠ æ›´å¤šæ£€æŸ¥ï¼ˆä»£ç è´¨é‡ã€å®‰å…¨æ‰«æï¼‰
5. â³ è®¾ç½®è‡ªåŠ¨éƒ¨ç½²
6. â³ é…ç½®é€šçŸ¥

ç°åœ¨ä½ çš„é¡¹ç›®å·²ç»é…ç½®å¥½äº† CI/CDï¼æ¯æ¬¡æ¨é€ä»£ç æ—¶ï¼ŒGitHub Actions éƒ½ä¼šè‡ªåŠ¨è¿è¡Œæµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚